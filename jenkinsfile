pipeline {
    agent any
    
    options {
        timeout(time: 1, unit: 'HOURS')
    }
    
    tools {
        nodejs 'NodeJS 14' // Replace with your Node.js installation name
    }
    
    stages {
        stage('Checkout') {
            steps {
                checkout scm
                // List files to ensure package.json is present
                sh 'ls -l'
                // Show contents of package.json for debugging purposes
                sh 'cat package.json'
            }
        }
        
        stage('Build') {
            steps {
                sh 'npm install'
                script {
                    // Read and parse package.json
                    def packageJson = readFile('package.json')
                    def jsonSlurper = new groovy.json.JsonSlurper()
                    def pkg = jsonSlurper.parseText(packageJson) as Map
                    // Convert LazyMap to HashMap
                    def pkgMap = new HashMap(pkg)
                    // Check for the build script in package.json
                    if (pkgMap.scripts && pkgMap.scripts.build) {
                        sh 'npm run build'
                    } else {
                        echo 'No build script defined in package.json'
                    }
                }
            }
        }
    }
}
